This is the code from branch2
added by kane
